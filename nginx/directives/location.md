## location介绍

##### `【原创】`
---

请求在执行`location`之前，会干以下事情

1. 解码被encoded(`"%XX"`)的内容
2. 转换相对路径，去掉路径中的`"."`、`".."`
3. 合并多个斜杠（`"/"`）为一个斜杠


命令参考手册
---

```nginx
Syntax: 	location [ = | ~ | ~* | ^~ ] uri { ... }
			location @name { ... }
Default: 	—
Context: 	server, location
```
* **=** 精确匹配
* **~** 正则，区分大小写
* __~*__ 正则，不区分大小写
* **^~** 前缀匹配，普通字符窜

location的匹配顺序如下。只是`匹配顺序`，不是`优先级`：

1. 匹配有 `=` 修饰符的location（`= /v1`），匹配成功则跳出匹配，否则执行下一步
2. 依次匹配所有`非正则`location（`/v1`），记住最长匹配的那个location（当然，没有匹配项就不需要记住了），然后进入下一步。注意：`location ^~ /v1` 也在`非正则location`这个范围，但它有点特殊。当`location ^~`匹配成功后，直接跳出匹配规则，否则继续下一步
3. 按照配置文件中的location顺序`正则匹配`，只要匹配成功就跳出匹配。如果整个配置文件的正则都试完了，就是没匹配成功，只能用第二步中`记住`的`非正则location`，然后跳出匹配。

上面说了很多的废话，来点更直接的表面现象（`优先级`）：  
`=` ==> `^~` ==> `第一个匹配成功正则` ==> `/xx（没有前缀修饰符）`

##### `location ^~ /v1`属于`非正则匹配`；`location ~ ^/v1`属于`正则匹配`  

##### `location ^~ /v1`和`location /v1`不能同时出现，否则报错：`duplicate location "/v1" in /data/nginx.conf`

> 注：Nginx版本从**0.7.1** - **0.8.41**间，如果前缀匹配（`/xx`）没有`=`或`^~`修饰符，也会终止匹配且不会执行正则匹配。